---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r setup}
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))
```

## Loading and preprocessing the data

```{r loaddata}
if (!file.exists("./data")) {
    dir.create("./data")
}

if (!file.exists("./activity.zip")) {
    fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
    download.file(fileURL, destFile = "./activity.zip", method = "curl")
}

if (!file.exists("./data/activity.csv")) {
    unzip("./activity.zip", exdir = "./data", overwrite = TRUE)
}

activity <- read_csv(
    "./data/activity.csv",
    col_types = cols(
        steps = col_integer(),
        date = col_date(format = "%Y-%m-%d"),
        interval = col_integer()
        )
    )
```

Dataset variables:

* **steps**: Number of steps taking in a 5-minute interval (missing values are coded as `NA`)
* **date**: The date on which the measurement was taken in `YYYY-MM-DD` format
* **interval**: Identifier for the 5-minute interval in which measurement was taken

```{r viewactivity}
str(activity)
```

## What is mean total number of steps taken per day?

```{r totalsteps}
sum_activity <- activity %>%
    group_by(date) %>%
    summarize(daily_step = sum(steps))

qplot(daily_step, data = sum_activity, binwidth = 2000)
```

Daily step mean = `r prettyNum(mean(sum_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`  
Daily step median = `r prettyNum(median(sum_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`

## What is the average daily activity pattern?

```{r averagestep}
avg_activity <- activity %>%
    group_by(interval) %>%
    summarize(average_step = mean(steps, na.rm = TRUE))

qplot(interval, average_step, data = avg_activity, geom = "line")
```

Interval with maximum value = `r avg_activity[which.max(avg_activity$average_step), 1]`  
Maximum average step value = `r avg_activity[which.max(avg_activity$average_step), 2]`

## Imputing missing values

Total number of missing step values = `r sum(is.na(activity$steps))`

### Strategy to replace missing values
Replace `NA` with 5-minute interval average across all days

```{r impute}
impute_activity <- activity %>%
    mutate(steps = ifelse(is.na(steps),
                      avg_activity$average_step[match(avg_activity$interval,interval)], steps))

sum_impute_activity <- impute_activity %>%
    group_by(date) %>%
    summarize(daily_step = sum(steps))

qplot(daily_step, data = sum_impute_activity, binwidth = 2000)
```

Imputed daily step mean = `r prettyNum(mean(sum_impute_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`  
Imputed daily step median = `r prettyNum(median(sum_impute_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`

Original daily step mean = `r prettyNum(mean(sum_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`  
Original daily step median = `r prettyNum(median(sum_activity$daily_step, na.rm = TRUE), scientific = FALSE, big.mark = ",")`

## Are there differences in activity patterns between weekdays and weekends?

```{r weekdays}
impute_activity <- impute_activity %>%
    mutate(dayname = wday(date, label = TRUE),
           weekday = factor((dayname %in% c("Mon", "Tue", "Wed", "Thu", "Fri")),
                            levels = c(FALSE, TRUE), labels = c("weekend", "weekday"))
           )

avg_impute_activity <- impute_activity %>%
    group_by(interval, weekday) %>%
    summarize(average_step = mean(steps))

qplot(interval, average_step, color = weekday, data = avg_impute_activity, geom = "line")
```